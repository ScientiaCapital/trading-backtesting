services:
  trading-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trading-backtesting
    ports:
      # Map container ports to host ports
      - "8000:8000"  # FastAPI/Uvicorn API
      - "8501:8501"  # Streamlit UI
      - "5001:5000"  # Flask (alternative API) - changed from 5000 to 5001
      - "3000:3000"  # Frontend dev server
    volumes:
      # Mount the entire project directory
      - .:/app:rw
      # Mount the .env file
      - ./.env:/app/.env:ro
    environment:
      - PYTHONPATH=/app
    networks:
      - trading-network
    stdin_open: true
    tty: true
    command: /bin/bash

  # Optional: Add a Jupyter notebook service for interactive testing
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trading-jupyter
    ports:
      - "8888:8888"
    volumes:
      - .:/app:rw
      - ./.env:/app/.env:ro
    environment:
      - PYTHONPATH=/app
    networks:
      - trading-network
    command: >
      sh -c "pip install jupyter notebook ipykernel &&
             python -m ipykernel install --user --name=trading &&
             jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token=''"

networks:
  trading-network:
    driver: bridge
